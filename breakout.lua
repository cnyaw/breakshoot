local BRICKS_PER_ROW = 11
local ROWS_PER_LEVEL = 18
local BRICK_W, BRICK_H = 20, 20
local TIME_RANDOM_BULLET = 40

local dummy_bounce_blocks = 28
local dummy_bricks = 20
local dummy_info = 30
local obj_paddle = 21
local obj_player = 22
local obj_left_touch_area
local obj_right_touch_area
local obj_exit = 26

local BREAKOUT_LEVELS = {
  [1] = {
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        9,9,9,9,9,9,9,9,9,9,9,
        5,5,5,5,5,5,5,5,5,5,5,
        6,6,6,6,6,6,6,6,6,6,6,
        8,8,8,8,8,8,8,8,8,8,8,
        3,3,3,3,3,3,3,3,3,3,3,
        1,1,1,1,1,1,1,1,1,1,1,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0
    },

  [2] = {
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        8,0,0,0,0,0,0,0,0,0,0,
        8,2,0,0,0,0,0,0,0,0,0,
        8,2,1,0,0,0,0,0,0,0,0,
        8,2,1,6,0,0,0,0,0,0,0,
        8,2,1,6,5,0,0,0,0,0,0,
        8,2,1,6,5,8,0,0,0,0,0,
        8,2,1,6,5,8,2,0,0,0,0,
        8,2,1,6,5,8,2,1,0,0,0,
        8,2,1,6,5,8,2,1,6,0,0,
        8,2,1,6,5,8,2,1,6,5,0,
        9,9,9,9,9,9,9,9,9,9,8,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0
    },

  [3] = {
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        4, 4, 4,10,10,10,10,10,10,10,10,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0,10,10,10,10,10,10,10, 4, 4, 4,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        6, 6, 6,10,10,10,10,10,10,10,10,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5
    },

  [4] = {
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,9,8,1,7,0,8,1,6,9,0,
        0,6,1,8,5,0,1,8,9,6,0,
        0,1,7,5,8,0,6,9,8,1,0,
        0,8,5,7,1,0,9,6,1,8,0,
        0,5,8,1,6,0,8,1,7,5,0,
        0,7,1,8,9,0,1,8,5,7,0,
        0,1,6,9,8,0,7,5,8,1,0,
        0,8,9,6,1,0,5,7,1,8,0,
        0,9,8,1,7,0,8,1,6,9,0,
        0,6,1,8,5,0,1,8,9,6,0,
        0,1,7,5,8,0,6,9,8,1,0,
        0,8,5,7,1,0,9,6,1,8,0,
        0,5,8,1,6,0,8,1,7,5,0,
        0,7,1,8,9,0,1,8,5,7,0
    },

  [5] = {
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,8,0,0,0,8,0,0,0,
        0,0,0,0,8,0,8,0,0,0,0,
        0,0,0,0,8,0,8,0,0,0,0,
        0,0,0,9,9,9,9,9,0,0,0,
        0,0,0,9,9,9,9,9,0,0,0,
        0,0,9,9,5,9,5,9,9,0,0,
        0,0,9,9,5,9,5,9,9,0,0,
        0,9,9,9,9,9,9,9,9,9,0,
        0,9,9,9,9,9,9,9,9,9,0,
        0,9,0,9,9,9,9,9,0,9,0,
        0,9,0,9,0,0,0,9,0,9,0,
        0,9,0,9,0,0,0,9,0,9,0,
        0,0,0,0,9,0,9,0,0,0,0,
        0,0,0,0,9,0,9,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0
    },

  [6] = {
        0,0, 0,0, 0,0, 0,0, 0,0,0,
        0,0, 0,0, 0,0, 0,0, 0,0,0,
        0,0, 0,0, 0,0, 0,0, 0,0,0,
        6,0, 5,0, 1,0, 1,0, 5,0,6,
        6,0, 5,0, 1,0, 1,0, 5,0,6,
        6,0, 5,0, 1,0, 1,0, 5,0,6,
        6,0,10,8,10,8,10,8,10,0,6,
        6,0, 5,0, 1,0, 1,0, 5,0,6,
        6,0, 5,0, 1,0, 1,0, 5,0,6,
        6,0, 5,0, 1,0, 1,0, 5,0,6,
        6,0, 5,0, 1,0, 1,0, 5,0,6,
        6,0, 5,0, 1,0, 1,0, 5,0,6,
        8,0,10,0,10,0,10,0,10,0,8,
        6,0, 5,0, 1,0, 1,0, 5,0,6,
        0,0, 0,0, 0,0, 0,0, 0,0,0,
        0,0, 0,0, 0,0, 0,0, 0,0,0,
        0,0, 0,0, 0,0, 0,0, 0,0,0,
        0,0, 0,0, 0,0, 0,0, 0,0,0
    },

  [7] = {
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,8,2,6,0,0,0,0,
        0,0,0,8,1,6,2,8,0,0,0,
        0,0,0,2,6,1,8,3,0,0,0,
        0,0,1,6,2,8,1,5,3,0,0,
        0,0,6,1,8,3,5,1,8,0,0,
        0,0,2,8,1,5,3,8,1,0,0,
        0,0,8,3,5,1,8,2,6,0,0,
        0,0,1,5,3,8,1,6,2,0,0,
        0,0,5,1,8,2,6,1,8,0,0,
        0,0,0,8,1,6,2,8,0,0,0,
        0,0,0,2,6,1,8,3,0,0,0,
        0,0,0,0,2,8,1,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0
    },

  [8] = {
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0,10, 0, 0,10, 0,10, 0, 0,10, 0,
        0,10,10, 0, 0, 0, 0, 0,10,10, 0,
        0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0,
        0, 0, 0, 0,10, 1,10, 0, 0, 0, 0,
        0, 0,10, 0, 0, 8, 0, 0,10, 0, 0,
        0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0,
        0, 0,10, 0, 0, 5, 0, 0,10, 0, 0,
        0, 0, 0, 0,10, 1,10, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 8, 0, 0, 0, 0, 0,
        0,10,10, 0, 0, 0, 0, 0,10,10, 0,
        0,10, 0, 0,10, 0,10, 0, 0,10, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    },

  [9] = {
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0,10, 0,10, 0, 0, 0,10, 0,10, 0,
        0,10, 1,10, 0, 0, 0,10, 1,10, 0,
        0,10, 6,10, 0, 0, 0,10, 6,10, 0,
        0,10,10,10, 0, 0, 0,10,10,10, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 7, 6, 6, 6, 8, 0, 0, 0,
        0, 0, 0, 7, 1, 2, 1, 8, 0, 0, 0,
        0, 0, 0, 7, 2, 1, 2, 8, 0, 0, 0,
        0, 0, 0, 7, 1, 2, 1, 8, 0, 0, 0,
        0, 0, 0, 7, 2, 1, 2, 8, 0, 0, 0,
        0, 0, 0, 7, 6, 6, 6, 8, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    },

  [10] = {
        0,10, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0,10, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0,10, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0,10, 0, 0, 0, 0, 6, 0, 0, 0, 0,
        0,10, 0, 0, 0, 6, 2, 6, 0, 0, 0,
        0,10, 0, 0, 6, 2, 6, 2, 6, 0, 0,
        0,10, 0, 6, 2, 6, 9, 6, 2, 6, 0,
        0,10, 0, 0, 6, 2, 6, 2, 6, 0, 0,
        0,10, 0, 0, 0, 6, 2, 6, 0, 0, 0,
        0,10, 0, 0, 0, 0, 6, 0, 0, 0, 0,
        0,10, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0,10, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0,10, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0,10, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0,10,10,10,10,10,10,10,10,10,10,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    },

  [11] = {
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,9,9,9,9,9,9,9,9,9,0,
        0,9,0,0,0,0,0,0,0,9,0,
        0,9,0,9,9,9,9,9,0,9,0,
        0,9,0,9,0,0,0,9,0,9,0,
        0,9,0,9,0,9,0,9,0,9,0,
        0,9,0,9,0,0,0,9,0,9,0,
        0,9,0,9,9,9,9,9,0,9,0,
        0,9,0,0,0,0,0,0,0,9,0,
        0,9,9,9,9,9,9,9,9,9,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0
    },

  [12] = {
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        10,10,10,10,10,10,10,10,10,10,10,
         0, 0, 0, 0,10, 0, 0, 0,10, 8, 0,
         0,10, 1, 0,10, 0, 0, 0,10, 0, 0,
         0,10, 0, 0,10, 0,10, 0,10, 0, 0,
         0,10, 0, 0,10, 0,10, 0,10, 0, 0,
         0,10, 0, 0,10, 1,10, 0,10, 0, 0,
         0,10, 0, 8,10, 0,10, 6,10, 0, 0,
         0,10, 0, 0,10, 5,10, 0,10, 0, 0,
         0,10, 0, 0,10, 0,10, 0,10, 0, 0,
         0,10, 0, 0,10, 0,10, 0,10, 0, 0,
         0,10, 2, 0, 0, 0,10, 0, 0, 0, 0,
         0,10, 0, 0, 0, 0,10, 0, 0, 0, 8,
         0,10,10,10,10,10,10,10,10,10,10,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    },

  [13] = {
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,8,8,0,4,4,4,0,8,8,0,
        0,4,4,0,8,8,8,0,4,4,0,
        0,6,6,0,5,5,5,0,6,6,0,
        0,7,7,0,1,1,1,0,7,7,0,
        0,1,1,0,7,7,7,0,1,1,0,
        0,5,5,0,6,6,6,0,5,5,0,
        0,8,8,0,4,4,4,0,8,8,0,
        0,4,4,0,8,8,8,0,4,4,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0
    },

  [14] = {
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         5, 9, 9, 9, 9, 9, 9, 9, 9, 9, 5,
        10, 0, 0, 0, 0, 0, 0, 0, 0, 0,10,
         6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         8, 9, 9, 9, 9, 9, 9, 9, 9, 9, 8,
        10, 0, 0, 0, 0, 0, 0, 0, 0, 0,10,
         6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         6, 9, 9, 9, 9, 9, 9, 9, 9, 9, 6,
        10, 0, 0, 0, 0, 0, 0, 0, 0, 0,10,
         5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
        10, 0, 0, 0, 0, 0, 0, 0, 0, 0,10,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    },

  [15] = {
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        2,9,9,2,2,2,2,2,9,9,2,
        2,9,8,9,2,2,2,9,1,9,2,
        2,9,8,8,9,9,9,1,1,9,2,
        2,9,8,8,8,9,1,1,1,9,2,
        2,9,8,8,8,9,1,1,1,9,2,
        2,9,8,8,8,9,1,1,1,9,2,
        2,9,8,8,8,9,1,1,1,9,2,
        2,9,8,8,8,9,1,1,1,9,2,
        2,9,8,8,8,9,1,1,1,9,2,
        2,2,9,8,8,9,1,1,9,2,2,
        2,2,2,9,8,9,1,9,2,2,2,
        2,2,2,2,9,9,9,2,2,2,2,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0
    },

  [16] = {
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,10, 0, 0, 0, 0, 0,
        0, 0, 0, 4, 4, 0, 4, 4, 0, 0, 0,
        0, 4, 4, 0, 0,10, 0, 0, 4, 4, 0,
        4, 0, 0, 8, 8, 0, 8, 8, 0, 0, 4,
        0, 8, 8, 0, 0,10, 0, 0, 8, 8, 0,
        8, 0, 0, 1, 1, 0, 1, 1, 0, 0, 8,
        0, 1, 1, 0, 0,10, 0, 0, 1, 1, 0,
        1, 0, 0, 5, 5, 0, 5, 5, 0, 0, 1,
        0, 5, 5, 0, 0,10, 0, 0, 5, 5, 0,
        5, 0, 0, 6, 6, 0, 6, 6, 0, 0, 5,
        0, 6, 6, 0, 0,10, 0, 0, 6, 6, 0,
        6, 0, 0, 1, 1, 0, 1, 1, 0, 0, 6,
        0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0,
        1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    },

  [17] = {
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 9, 0, 0, 0, 0, 0,
        0, 0, 0, 6, 6, 9, 1, 1, 0, 0, 0,
        0, 0, 6, 6, 4, 4, 4, 1, 1, 0, 0,
        0, 6, 6, 4, 4, 4, 4, 4, 1, 1, 0,
        0, 6, 6, 4, 4, 4, 4, 4, 1, 1, 0,
        0, 6, 6, 4, 4, 4, 4, 4, 1, 1, 0,
        0, 9, 0, 9, 0, 9, 0, 9, 0, 9, 0,
        0, 0, 0, 0, 0, 9, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 9, 0, 0, 0, 0, 0,
        0, 0, 0,10, 0,10, 0, 0, 0, 0, 0,
        0, 0, 0,10,10,10, 0, 0, 0, 0, 0,
        0, 0, 0, 0,10, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    },

  [18] = {
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        8, 0,10, 3, 3, 3, 3, 3,10, 0, 8,
        8, 0,10,10, 3, 3, 3,10,10, 0, 8,
        8, 0,10, 0,10, 3,10, 0,10, 0, 8,
        8, 0,10, 0, 1, 9, 1, 0,10, 0, 8,
        8, 0,10, 0, 1, 0, 1, 0,10, 0, 8,
        8, 0,10, 0, 1, 0, 1, 0,10, 0, 8,
        8, 0,10, 0, 1, 0, 1, 0,10, 0, 8,
        8, 0,10, 0, 1, 0, 1, 0,10, 0, 8,
        8, 0,10, 0, 1, 0, 1, 0,10, 0, 8,
        8,10,10,10, 1, 0, 1,10,10,10, 8,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    },

  [19] = {
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0,10,10,10,10,10,10,10, 0, 0,
        0, 0, 1, 5, 6,10, 6, 5, 1, 0, 0,
        0, 0, 1, 5, 6,10, 6, 5, 1, 0, 0,
        0, 0, 1, 5, 6,10, 6, 5, 1, 0, 0,
        0, 0, 1, 5, 6,10, 6, 5, 1, 0, 0,
        0, 0, 1, 5, 6,10, 6, 5, 1, 0, 0,
        0, 0, 1, 5, 6,10, 6, 5, 1, 0, 0,
        0, 0, 1, 5, 6,10, 6, 5, 1, 0, 0,
        0, 0,10,10,10,10,10,10,10, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    },

  [20] = {
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        1,10, 8,10, 2,10, 1,10, 7,10, 8,
        7,10, 9,10, 9,10, 9,10, 9,10, 2,
        0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 0,
        0,10, 0,10, 7,10, 0,10, 0,10, 0,
        0,10, 0,10, 0,10, 7,10, 0,10, 0,
        0,10, 0,10, 0,10, 0,10, 7,10, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0,10, 0,10, 0,10, 7,10, 0,10, 0,
        0,10, 0,10, 7,10, 0,10, 0,10, 0,
        0, 0, 7,10, 0,10, 0,10, 0, 0, 0,
        7, 0, 0, 0, 0,10, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    },

  [21] = {
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0,10, 8, 8, 8, 8, 8, 8, 8,10, 0,
        0,10, 0, 0, 0, 0, 0, 0, 0,10, 0,
        0,10, 0,10,10,10,10,10, 0,10, 0,
        0,10, 0,10, 6, 6, 6,10, 0,10, 0,
        0,10, 0,10, 7, 7, 7,10, 0,10, 0,
        0,10, 0,10, 1, 1, 1,10, 0,10, 0,
        0,10, 0,10, 8, 8, 8,10, 0,10, 0,
        0,10, 0,10, 2, 2, 2,10, 0,10, 0,
        0,10, 0, 0, 0, 0, 0, 0, 0,10, 0,
        0,10, 0, 0, 0, 0, 0, 0, 0,10, 0,
        0,10,10,10,10,10,10,10,10,10, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    },

  [22] = {
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
        8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        5,10, 0,10, 5, 5, 5,10, 0,10, 5,
        5,10, 0,10, 5, 5, 5,10, 0,10, 5,
        5,10, 0,10, 5, 5, 5,10, 0,10, 5,
        5,10, 0,10, 5, 5, 5,10, 0,10, 5,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
        4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    },

  [23] = {
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        6,6,6,6,6,6,6,6,6,6,6,
        0,0,0,0,0,0,0,0,0,0,0,
        9,9,9,0,9,9,9,0,9,9,9,
        9,1,9,0,9,1,9,0,9,1,9,
        9,9,9,0,9,9,9,0,9,9,9,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,9,9,9,0,9,9,9,0,0,
        0,0,9,5,9,0,9,5,9,0,0,
        0,0,9,9,9,0,9,9,9,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        9,9,9,0,9,9,9,0,9,9,9,
        9,6,9,0,9,6,9,0,9,6,9,
        9,9,9,0,9,9,9,0,9,9,9,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0
    },

  [24] = {
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,4,4,4,0,0,0,0,
        0,0,0,0,4,4,4,0,0,0,0,
        0,0,0,0,4,4,4,0,0,0,0,
        0,0,0,4,6,4,6,4,0,0,0,
        0,0,0,6,6,6,6,6,0,0,0,
        0,0,6,6,6,6,6,6,6,0,0,
        0,0,6,6,6,6,6,6,6,0,0,
        0,6,6,6,6,6,6,6,6,6,0,
        6,6,6,6,6,6,6,6,6,6,6,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0
    },

  [25] = {
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
         1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
         6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,
        10,10,10,10, 5, 5, 5,10,10,10,10,
        10, 1, 1,10, 9, 9, 9,10, 1, 1,10,
        10, 5, 5,10, 0, 0, 0,10, 6, 6,10,
        10, 0, 0, 0, 0, 0, 0, 0, 0, 0,10,
        10, 0, 0, 0, 0, 0, 0, 0, 0, 0,10,
        10, 0, 0, 0, 0, 0, 0, 0, 0, 0,10,
        10, 0, 0,10, 1, 1, 1,10, 0, 0,10,
        10, 9, 9,10,10,10,10,10, 9, 9,10,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    },

  [26] = {
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0,10, 9, 9,10, 0, 0, 0, 0, 0,
         0,10, 0, 0, 0, 0,10, 0, 0, 0, 0,
        10, 0, 0, 2, 2, 0, 0,10, 0, 0, 0,
        10, 0, 6, 6, 6, 6, 0,10, 0, 0, 0,
        10, 0, 0, 7, 7, 0, 0,10, 0, 0, 0,
         0,10, 0, 0, 0, 0,10, 0, 0, 0, 0,
         0, 0,10,10,10,10, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    },

  [27] = {
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        9,9,9,9,9,9,9,9,9,9,9,
        8,8,8,8,8,8,8,8,8,8,8,
        9,9,9,9,9,9,9,9,9,9,9,
        0,0,0,0,0,0,0,0,0,0,0,
        9,9,9,9,9,9,9,9,9,9,9,
        5,5,5,5,5,5,5,5,5,5,5,
        9,9,9,9,9,9,9,9,9,9,9,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0
    },

  [28] = {
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,
        6,10,10,10, 3,10, 3,10,10,10, 6,
        6,10, 0, 0, 0, 0, 0, 0, 0,10, 6,
        6,10, 3, 0, 0, 0, 0, 0, 3,10, 6,
        6,10, 3, 3, 0, 0, 0, 3, 3,10, 6,
        0, 6,10, 3, 3, 0, 3, 3,10, 6, 0,
        0, 0, 6,10, 3, 3, 3,10, 6, 0, 0,
        0, 0, 0, 6,10, 3,10, 6, 0, 0, 0,
        0, 0, 0, 0, 6, 3, 6, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    },

  [29] = {
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         6, 6, 6, 6,10, 0,10, 6, 6, 6, 6,
         1, 1, 1, 1,10, 0,10, 1, 1, 1, 1,
        10,10,10,10,10, 0,10,10,10,10,10,
         7, 7, 7, 7,10, 0,10, 7, 7, 7, 7,
         3, 3, 3, 3,10, 0,10, 3, 3, 3, 3,
         6, 6, 6, 6,10, 0,10, 6, 6, 6, 6,
         9, 9, 9, 9,10, 0,10, 9, 9, 9, 9,
         3, 3, 3, 3,10, 0,10, 3, 3, 3, 3,
         7, 7, 7, 7,10, 0,10, 7, 7, 7, 7,
         1, 1, 1, 1,10, 0,10, 1, 1, 1, 1,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    },

  [30] = {
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        8, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        8, 7, 2, 1, 0, 0, 0, 0, 0, 0, 0,
        8, 7, 2, 1, 8, 7, 0, 0, 0, 0, 0,
        8, 7, 2, 1, 8, 7, 2, 1, 0, 0, 0,
        9, 7, 2, 1, 8, 7, 2, 1, 8, 7, 0,
        0,10, 9, 1, 8, 7, 2, 1, 8, 7, 2,
        0, 0, 0,10, 9, 7, 2, 1, 8, 7, 2,
        0, 0, 0, 0, 0,10, 9, 1, 8, 7, 2,
        0, 0, 0, 0, 0, 0, 0,10, 9, 7, 2,
        0, 0, 0, 0, 0, 0, 0, 0, 0,10, 9,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    },

  [31] = {
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        6,0,5,0,1,0,7,0,6,0,5,
        9,0,9,0,9,0,9,0,9,0,9,
        0,1,0,5,0,6,0,8,0,1,0,
        0,9,0,9,0,9,0,9,0,9,0,
        8,0,6,0,5,0,1,0,7,0,6,
        9,0,9,0,9,0,9,0,9,0,9,
        0,7,0,1,0,5,0,6,0,8,0,
        0,9,0,9,0,9,0,9,0,9,0,
        1,0,8,0,6,0,5,0,1,0,7,
        9,0,9,0,9,0,9,0,9,0,9,
        0,6,0,7,0,1,0,5,0,6,0,
        0,9,0,9,0,9,0,9,0,9,0,
        5,0,1,0,8,0,6,0,5,0,1,
        9,0,9,0,9,0,9,0,9,0,9,
        0,0,0,0,0,0,0,0,0,0,0
    },

  [32] = {
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0,10, 0,10, 0,10, 0,10, 0, 0,
        0, 0,10, 0,10, 0,10, 0,10, 0, 0,
        0, 0,10, 0,10, 0,10, 0,10, 0, 0,
        0, 0,10, 0,10, 0,10, 5, 5, 0, 0,
        0, 0,10, 0,10, 0,10, 0,10, 0, 0,
        0, 0,10, 0,10, 6, 6, 6, 6, 0, 0,
        0, 0,10, 0,10, 0,10, 0,10, 0, 0,
        0, 0,10, 5, 5, 5, 5, 5, 5, 0, 0,
        0, 0,10, 0,10, 0,10, 0,10, 0, 0,
        0, 0, 8, 8, 8, 8, 8, 8, 8, 0, 0,
        0, 0, 9, 9, 9, 9, 9, 9, 9, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    },

  [33] = {
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,5,5,0,0,0,0,
        0,0,0,0,5,9,9,5,0,0,0,
        0,0,0,0,5,9,5,5,0,0,0,
        0,0,0,0,5,5,5,5,0,0,0,
        0,0,0,0,5,5,5,5,0,0,0,
        0,0,0,0,5,5,5,5,0,0,0,
        0,0,0,1,1,5,5,5,6,0,0,
        0,0,1,9,9,5,5,9,9,6,0,
        0,0,1,9,1,1,6,9,6,6,0,
        0,0,1,1,1,1,6,6,6,6,0,
        0,0,1,1,1,1,6,6,6,6,0,
        0,0,1,1,1,1,6,6,6,6,0,
        0,0,1,1,1,1,6,6,6,6,0,
        0,0,0,1,1,0,0,6,6,0,0,
        0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0
    },

  [34] = {
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 2, 2, 2, 0, 0,
        0, 0, 0, 0, 0, 0, 2, 2, 7, 0, 0,
        0, 0, 0, 0, 0, 2, 2, 7, 7, 7, 0,
        0, 0, 0, 0, 0, 2, 2, 2, 7, 6, 0,
        0, 0, 0, 0, 0, 2, 2, 2, 2, 6, 0,
        0, 0, 0, 0,10, 2, 2, 2, 2, 6, 0,
        0, 0, 0, 0, 8, 6, 2, 2, 6, 6, 0,
        0, 0, 0, 0, 8, 8, 6, 6, 6, 0, 0,
        0, 0, 0,10, 8,10, 6, 6, 6, 0, 0,
        0, 0, 0, 8, 8, 8, 8, 0, 0, 0, 0,
        0, 0,10, 8,10, 8, 0, 0, 0, 0, 0,
        0, 0, 8, 8, 8, 8, 0, 0, 0, 0, 0,
        0, 0, 8, 8, 8, 0, 0, 0, 0, 0, 0,
        0, 8, 8, 8, 0, 0, 0, 0, 0, 0, 0,
        0, 8, 8, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    },

  [35] = {
         0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 4,
         0, 0, 0, 4, 4, 4, 4, 0, 0, 0, 0,
         0, 0, 0, 0, 4, 4, 4, 4, 0, 0, 0,
         0, 0, 0, 0, 0,10,10,10, 0, 0, 0,
         0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 4, 8, 4, 0, 0, 0, 0, 0, 0, 0,
         4, 8,10, 8, 4, 0, 0, 0, 0, 0, 0,
         0, 4, 8, 4, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 8,
         0, 0, 7, 0, 0,10, 0, 1, 1, 1, 0,
         1, 0, 7, 0, 1, 0, 1, 0, 1, 7, 1,
        10, 1, 7, 1, 0, 7, 1,10, 1, 0, 0,
        10, 1, 7, 1, 0, 1, 0, 8, 1, 1, 0,
        10,10, 1,10, 1, 0, 0, 1, 1, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    }
}

local function GenBullet()
  local nc = Good.GetChildCount(dummy_bricks)
  local o = Good.GetChild(dummy_bricks, math.random(nc) - 1)
  local x,y = Good.GetPos(o, 1)
  Stge.RunScript('aim1', x, y)
  return Good.GetParam(o).ch
end

local function GenLevel(n, char_i)
  Good.KillAllChild(dummy_bricks)
  local lvl = BREAKOUT_LEVELS[n]
  local i = AutoIncrementor()
  local minY, minX, maxX = 1000, 1000, -1000
  for r = 1, ROWS_PER_LEVEL do
    for c = 1, BRICKS_PER_ROW do
      local t = lvl[i()]
      if (0 ~= t) then
        local ch = char_i()
        local o = GenScaleCharObj(ch, BRICK_W)
        Good.AddChild(dummy_bricks, o)
        Good.GetParam(o).ch = ch
        local x, y = (c - 1) * BRICK_W, (r - 1) * BRICK_H
        Good.SetPos(o, x, y)
        minX = math.min(minX, x)
        maxX = math.max(maxX, x)
        minY = math.min(minY, y)
      end
    end
  end
  Good.SetPos(dummy_bricks, (SCR_W - (maxX - minX + BRICK_W))/2, -minY + BRICK_H)
end

local function ShowLevelInfo(lvl)
  Good.KillAllChild(dummy_info)
  Graphics.SetFont(Graphics.FIXED_FONT)
  local o = Good.GenTextObj(dummy_info, string.format('%d / %d', lvl, #BREAKOUT_LEVELS), 2)
  SetTextObjColor(o, 0xff808080)
end

local function GotoNextLevel(param)
  local lvl = param.lvl_i()
  if (#BREAKOUT_LEVELS < lvl) then
    param.lvl_i = AutoIncrementor()
    lvl = param.lvl_i()
  end
  GenLevel(lvl, param.char_i)
  ShowLevelInfo(lvl)
end

local function FlipVerticle(o)
  local param = Good.GetParam(o)
  param.diry = -param.diry
  param.hit = param.hit + 1
end

local function HittestBounceBlocksByPaddle()
  local nc = Good.GetChildCount(dummy_bounce_blocks)
  for i = 0, nc - 1 do
    local o = Good.GetChild(dummy_bounce_blocks, i)
    local param = Good.GetParam(o)
    if (0 < param.hit) then
      local x, y = Good.GetPos(o)
      if (PtInObj(x, y, obj_paddle)) then
        FlipVerticle(o)
      end
    end
  end
end

local function HittestBrickByBounceBlocks(brick)
  local bx, by = Good.GetPos(brick, 1)
  local nc = Good.GetChildCount(dummy_bounce_blocks)
  for i = 0, nc - 1 do
    local o = Good.GetChild(dummy_bounce_blocks, i)
    local x, y = Good.GetPos(o)
    if (PtInRect(x, y, bx - BRICK_W/2, by - BRICK_H/2, bx + BRICK_W/2, by + BRICK_H/2)) then
      GenHitFxByPos(x, y)
      FlipVerticle(o)
      return true
    end
  end
end

local function HittestBricks()
  local nc = Good.GetChildCount(dummy_bricks)
  for i = nc - 1, 0, -1 do
    local o = Good.GetChild(dummy_bricks, i)
    if (HittestBrickByBounceBlocks(o)) then
      Good.KillObj(o)
    end
  end
end

local function HittestParticles(param)
  local p = Stge.GetFirstParticle()
  while (-1 ~= p) do
    local nextp = Stge.GetNextParticle(p)
    if (not IsEffect(p)) then
      local o = HittestParticleByPaddle(param, p, obj_paddle, 'BreakoutBouncingBlock')
      if (-1 ~= o) then
        Good.AddChild(dummy_bounce_blocks, o)
      end
    end
    p = nextp
  end
end

local function RandomFireBullet(param)
  param.timer = param.timer - 1
  if (0 == param.timer) then
    param.last_ch = GenBullet()
    param.timer = TIME_RANDOM_BULLET
  end
end

BreakoutBouncingBlock = {}

BreakoutBouncingBlock.OnCreate = function(param)
  param.hit = 0                         -- hit > 0 to enable hittest with paddle.
end

BreakoutBouncingBlock.OnStep = function(param)
  DefaultBouncingBlockOnStep(param)
end

Breakout = {}

Breakout.OnCreate = function(param)
  obj_left_touch_area, obj_right_touch_area = FindTouchAreaObj(param._id)
  param.char_i = MyIncrementor()
  param.lvl_i = AutoIncrementor()
  local lvl = param.lvl_i()
  GenLevel(lvl, param.char_i)
  ShowLevelInfo(lvl)
  param.timer = TIME_RANDOM_BULLET
  Stge.SetPlayer(obj_player)
  Stge.RunScript('star')
end

Breakout.OnStep = function(param)
  if (Input.IsKeyPressed(Input.ESCAPE)) then
    Good.GenObj(-1, 24)                 -- Back to select.
    return
  end
  if (nil == param.init_stars) then
    param.stars = GenBkgndStars()
    SetTopmost(obj_paddle)
    local x, y = Good.GetPos(obj_paddle)
    MoveStars(param.stars, x)
    param.init_stars = true
  end
  if (Input.IsKeyPressed(Input.LBUTTON)) then
    local x,y = Input.GetMousePos()
    if (PtInObj(x, y, obj_exit)) then
      Good.GenObj(-1, 24)               -- Back to select.
      return
    end
  end
  RandomFireBullet(param);
  MovePaddle(param, obj_paddle, obj_left_touch_area, obj_right_touch_area)
  -- Hittest.
  HittestParticles(param)
  HittestBricks()
  HittestBounceBlocksByPaddle()
  if (0 == Good.GetChildCount(dummy_bricks)) then
    GotoNextLevel(param)
  end
end

Breakout.OnNewParticle = function(param, p, i)
  if (nil == param.init_stars) then
    return
  end
  local o
  if (IsEffect(p)) then
    o = GenColorObj(-1, 1, 1, 0xffffffff)
  else
    o = GenScaleCharObj(param.last_ch, CHAR_SZ/2)
  end
  Stge.BindParticle(p, o, i)
end

Breakout.OnKillParticle = function(param, p, i)
  Good.KillObj(Stge.GetParticleBind(p, i))
end
